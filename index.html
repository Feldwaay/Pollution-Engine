<!DOCTYPE html>
<html>
<head>
  <title>Pollution Classification Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #f4f4f4;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
    }

    button {
      margin-top: 15px;
      padding: 10px 15px;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #eee;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Pollution Classification Engine</h2>
  <button onclick="runTest()">Run Test Case</button>

  <div class="result" id="output"></div>
</div>

<script>
function classifyStation(input) {
  const {
    aqi,
    pm25,
    no2,
    windSpeed,
    industrialDistance,
    trafficIndex,
    nearbyStationSpikeCount,
    citizenReportCount,
    farmInfluenceIndex
  } = input;

  const distanceFactor = Math.max(0, 1 - industrialDistance / 10);
  const citizenFactor = Math.min(citizenReportCount / 5, 1);
  const lowTrafficFactor = 1 - trafficIndex;
  const spreadFactor = Math.min(nearbyStationSpikeCount / 5, 1);
  const no2Factor = Math.min(no2 / (pm25 + 1), 1);
  const farmFactor = Math.min(farmInfluenceIndex, 1);

  let industrialScore = 0;
  if (aqi > 200) industrialScore += 30;
  industrialScore += 30 * distanceFactor;
  industrialScore += 20 * citizenFactor;
  industrialScore += 10 * lowTrafficFactor;

  let vehicularScore = 0;
  vehicularScore += 50 * trafficIndex;
  vehicularScore += 30 * no2Factor;

  let regionalScore = 0;
  regionalScore += 50 * spreadFactor;

  let farmScore = 0;
  farmScore += 40 * farmFactor;
  farmScore += 30 * spreadFactor;

  if (windSpeed < 1) {
    industrialScore *= 0.6;
    regionalScore *= 0.8;
    farmScore *= 0.7;
    vehicularScore += 10;
  }

  const scores = {
    industrialScore,
    vehicularScore,
    regionalScore,
    farmScore
  };

  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);

  const [topLabel, topScore] = sorted[0];
  const [, secondScore] = sorted[1];

  let label = "Uncertain";

  if (topScore >= 30) {
    if (topScore - secondScore < 10) {
      label = "Mixed Contribution";
    } else {
      label =
        topLabel === "industrialScore"
          ? "Likely Industrial"
          : topLabel === "vehicularScore"
          ? "Likely Vehicular"
          : topLabel === "regionalScore"
          ? "Likely Regional Transport"
          : "Likely Agricultural Burning";
    }
  }

  let confidence = 0;
  if (topScore > 0) {
    confidence = ((topScore - secondScore) / topScore) * 100;
  }
  confidence = Math.max(0, Math.min(100, confidence));

  return {
    industrialScore: Math.round(industrialScore),
    vehicularScore: Math.round(vehicularScore),
    regionalScore: Math.round(regionalScore),
    farmScore: Math.round(farmScore),
    label,
    confidence: Math.round(confidence)
  };
}

function runTest() {
  const testStation = {
    aqi: 300,
    pm25: 200,
    no2: 50,
    windSpeed: 3,
    industrialDistance: 2,
    trafficIndex: 0.3,
    nearbyStationSpikeCount: 4,
    citizenReportCount: 3,
    farmInfluenceIndex: 0.6
  };

  const result = classifyStation(testStation);

  document.getElementById("output").innerHTML = `
    <strong>Classification:</strong> ${result.label}<br>
    <strong>Confidence:</strong> ${result.confidence}%<br><br>
    Industrial Score: ${result.industrialScore}<br>
    Vehicular Score: ${result.vehicularScore}<br>
    Regional Score: ${result.regionalScore}<br>
    Farm Score: ${result.farmScore}
  `;
}
</script>

</body>
</html>
